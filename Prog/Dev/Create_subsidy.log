1                                       The SAS System           17:56 Saturday, August 1, 2015

NOTE: Copyright (c) 2002-2008 by SAS Institute Inc., Cary, NC, USA. 
NOTE: SAS (r) Proprietary Software 9.2 (TS2M3) 
      Licensed to THE URBAN INSTITUTE, Site 70097024.
NOTE: This session is executing on the X64_VSHOME  platform.



NOTE: SAS initialization used:
      real time           0.16 seconds
      cpu time            0.12 seconds
      

NOTE: AUTOEXEC processing beginning; file is C:\Users\Peter\Documents\My SAS 
      Files\9.2\Autoexnt.sas.


NOTE: AUTOEXEC processing completed.

1          /**************************************************************************
2           Program:  Create_subsidy.sas
3           Library:  PresCat
4           Project:  NeighborhoodInfo DC
5           Author:   P. Tatian
6           Created:  08/10/13
7           Version:  SAS 9.1
8           Environment:  Local Windows session (desktop)
9          
10          Description:  Create full PresCat.Subsidy data set from Subsidy_mfa
11          and Subsidy_other.
12         
13          Modifications:
14           10/26/13 PAT Add Agency and Portfolio vars.
15           10/18/13 PAT Set subsidies to not active if project is in
16                    Lost Rental list (TEMPORARY FIX).
17           09/27/14 PAT Updated for SAS1.
18           12/31/14 PAT Updated Portfolio variable to use new codes. Conversion
19                        from Program to Portfolio now uses $progtoportfolio fmt.
20           01/08/15 PAT Changed Update_date to Update_dtm (datetime).
21           01/16/15 PAT Added label for Compl_end.
22           06/18/15 PAT Corrections for Museum Sq One (latest updates).
23           06/27/15 PAT Added POA_start_orig, value of earliest start date
24                        recorded. (Values need to be verified against older data.)
25         **************************************************************************/
26         
27         /*%include "L:\SAS\Inc\StdLocal.sas";*/
28         %include "C:\DCData\SAS\Inc\StdLocal.sas";
NOTE: Library _METADAT does not exist.
74        +
75        +options ls=124 ps=48;    ** Landscape **;
2 The SAS System                                                                              17:56 Saturday, August 1, 2015

76        +
77        +** Output title **;
78        +
79        +title "&_library/&_program:  NeighborhoodInfo DC";
80        +
81        +** Define General library for local session only **;
82        +
83        +%DCData_lib( General, env=windows, macdef=dcautos uiautos sasautos )
MPRINT(DCDATA_LIB):   options nomprint;
NOTE: Libref GENERA_L was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: C:\DCData\Libraries\General\Data
NOTE: Libname GENERA_R refers to the same physical library as GENERA_L.
NOTE: Libref GENERA_R was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: C:\DCData\Libraries\General\Data
NOTE: Libref GENERAL was successfully assigned as follows: 
      Levels:           2
      Engine(1):        V9 
      Physical Name(1): C:\DCData\Libraries\General\Data
      Engine(2):        V9 
      Physical Name(2): C:\DCData\Libraries\General\Data

=====================================================================
Current FmtSearch Option value:

     WORK* LIBRARY* GENERAL

   *implicitly included by default.

=====================================================================
Status of current catalogs:

NOTE:    WORK.FORMATS DOES NOT EXIST
NOTE:    LIBRARY.FORMATS DOES NOT EXIST
NOTE:    GENERAL.FORMATS EXISTS
=====================================================================


=====================================================================
Current Sasautos Option value:

     GENERA_L DCAUTOS UIAUTOS SASAUTOS

=====================================================================

3 The SAS System                                                                              17:56 Saturday, August 1, 2015


=====================================================================
Current Sasautos Option value:

     GENERA_L  GENERA_R DCAUTOS UIAUTOS SASAUTOS

=====================================================================

84        +
85        +%let _userid = %sysfunc( putc( %lowcase(&SYSUSERID), $longusr. ) );
NOTE: %INCLUDE (level 1) ending.
86         
87         ** Define libraries **;
88         %DCData_lib( PresCat, local=n )
MPRINT(DCDATA_LIB):   options nomprint;
NOTE: Libref PRESCA_R was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: C:\DCData\Libraries\PresCat\Data
NOTE: Libref PRESCAT was successfully assigned as follows: 
      Levels:           1
      Engine(1):        V9 
      Physical Name(1): C:\DCData\Libraries\PresCat\Data

=====================================================================
Current FmtSearch Option value:

     WORK* LIBRARY* GENERAL PRESCAT

   *implicitly included by default.

=====================================================================
Status of current catalogs:

NOTE:    WORK.FORMATS DOES NOT EXIST
NOTE:    LIBRARY.FORMATS DOES NOT EXIST
NOTE:    GENERAL.FORMATS EXISTS
NOTE:    PRESCAT.FORMATS EXISTS
=====================================================================


=====================================================================
Current Sasautos Option value:

     PRESCA_R GENERA_L GENERA_R DCAUTOS UIAUTOS SASAUTOS

=====================================================================
4 The SAS System                                                                              17:56 Saturday, August 1, 2015


89         
90         /*
91         proc format;
92           value $Portfol
93             '202 Direct Loan/Elderly/Pre - 1974' = 'Section 202/811'
94             '202/8 Direct Loan/Elderly-Handicapped' = 'Section 202/811'
95             '202/811 Capital Advance' = 'Section 202/811'
96             '207/223(f) Pur/Refin Hsg.' = 'Other'
97             '220 Urban Renewal Hsg.' = 'Other'
98             '221(d)(3) BMIR Urban Renewal/Coop Hsg' = 'Section 221(d)(3) below market rate interest (BMIR)'
99             '221(d)(3) Mkt. Rate Moderate Inc/Disp Fams' = 'Section 221(d)(3)&(4) with affordability restrictions'
100            '221(d)(4) Mkt. Rate Mod Inc/Disp Fams' = 'Section 221(d)(3)&(4) with affordability restrictions'
101            '223(a)(7)/207/223(f) Refinanced Insurance' = 'Section 223'
102            '223(a)(7)/220 Refi/Urban Renewal' = 'Section 223'
103            '223(a)(7)/221(d)(3) MKT Refi/Moderate Income' = 'Section 221(d)(3)&(4) with affordability restrictions'
104            '223(a)(7)/221(d)(4) MKT Refi/Moderate Income' = 'Section 221(d)(3)&(4) with affordability restrictions'
105            '223(a)(7)/221(d)(4) MKT/244 Refi/Mod Income Co-In' = 'Section 221(d)(3)&(4) with affordability restrictions'
106            '223(a)(7)/232 Refi/Nursing Home' = 'Section 223'
107            '232 Nursing Homes' = 'Section 232'
108            '232/223(f)/Pur/Refin/Nursing Hms' = 'Section 232'
109            '236(j)(1)/Lower Income Families' = 'Section 236'
110            '241(a)/221-BMIR Improvements & Additions' = 'Other'
111            '542(b) QPE Risk Sharing-Recent Comp' = 'Section 542(b)&(c)'
112            '542(b) QPE Risk Sharing-Existing' = 'Section 542(b)&(c)'
113            '542(c) HFA Risk Sharing-Existing' = 'Section 542(b)&(c)'
114            '542(c) HFA Risk Sharing-Recent Comp' = 'Section 542(b)&(c)'
115            'CDBG' = 'Community Development Block Grants'
116            'DC Housing Production Trust Fund' = 'DC Housing Production Trust Fund'
117            'HOME' = 'HOME'
118            'Low Income Housing Tax Credit' = 'LIHTC'
119            'McKinney Vento Act loan' = 'McKinney Vento Act loan'
120            'PRAC 202/811' = 'Project Rental Assistance Contract (PRAC)'
121            'Public housing' = 'Public Housing'
122            'Sec 202' = 'Section 202/811'
123            'Sec 8 loan management' = 'Project-based Section 8'
124            'Sec 8 new construction' = 'Project-based Section 8'
125            'Sec 8 property disposition' = 'Project-based Section 8'
126            'Sec 8 rehabilitation' = 'Project-based Section 8'
127            'Sec 8 state agency' = 'Project-based Section 8'
128            'Tax exempt bond' = 'Tax exempt bond'
129            other = ' ';
130        run;
131        */
132        
133        proc sort data=PresCat.Subsidy_mfa out=Subsidy_mfa;
5 The SAS System                                                                              17:56 Saturday, August 1, 2015

134          by Nlihc_id mfa_start mfa_end;
135        

NOTE: There were 121 observations read from the data set PRESCAT.SUBSIDY_MFA.
NOTE: SAS sort was used.
NOTE: The data set WORK.SUBSIDY_MFA has 121 observations and 32 variables.
NOTE: Compressing data set WORK.SUBSIDY_MFA decreased size by 37.50 percent. 
      Compressed is 5 pages; un-compressed would require 8 pages.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds
      

136        proc sort data=PresCat.Subsidy_other out=Subsidy_other;
137          by Nlihc_id poa_start poa_end;
138        
139        ** New subsidy records **;
140        

NOTE: There were 586 observations read from the data set PRESCAT.SUBSIDY_OTHER.
NOTE: SAS sort was used.
NOTE: The data set WORK.SUBSIDY_OTHER has 586 observations and 12 variables.
NOTE: Compressing data set WORK.SUBSIDY_OTHER decreased size by 45.45 percent. 
      Compressed is 6 pages; un-compressed would require 11 pages.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.00 seconds
      cpu time            0.01 seconds
      

141        data Subsidy_new;
142        
143          length
144            Nlihc_id $ 8
145            Units_Assist  8
146            POA_start  8
147            POA_end  8
148            POA_end_prev 8
149            contract_number $ 11
150            rent_to_FMR_description $ 40
151            Subsidy_Active  3
152            Subsidy_Info_Source_ID $ 40
153            Subsidy_Info_Source $ 40
154            Subsidy_Info_Source_Date  8
155            Update_Dtm  8
156            Program $ 32
157            Agency $ 80;
6 The SAS System                                                                              17:56 Saturday, August 1, 2015

158        
159          Nlihc_id = "NL001033";
160          Units_Assist = .;
161          POA_start = .;
162          POA_end = .;
163          POA_end_prev = .;
164          contract_number = "DC39Q031002";
165          rent_to_FMR_description = "";
166          Subsidy_Active = .;
167          Subsidy_Info_Source_ID = "800219652/DC39Q031002";
168          Subsidy_Info_Source = "HUD/MFA";
169          Subsidy_Info_Source_Date = .;
170          Update_Dtm = .;
171          Program = "PRAC/811";
172          Agency = "";
173        
174          output;
175        
176        run;

NOTE: The data set WORK.SUBSIDY_NEW has 1 observations and 14 variables.
NOTE: Compressing data set WORK.SUBSIDY_NEW increased size by 100.00 percent. 
      Compressed is 2 pages; un-compressed would require 1 pages.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

177        
178        data PresCat.Subsidy (label="Preservation Catalog, Project subsidies");
179        
180          length Nlihc_id $ 8 Subsidy_id 8;
181        
182          set
183            Subsidy_mfa
184              (keep=Nlihc_id Subsidy_Active Program Contract_Number mfa_assunits mfa_start mfa_end Subsidy_Info_Source
185                    Subsidy_Info_Source_ID Subsidy_Info_Source_Date Update_Dtm Compl_end
186                    rent_to_FMR_description
187               rename=(mfa_assunits=Units_Assist mfa_start=POA_start mfa_end=POA_end))
188            Subsidy_other
189              (drop=Subsidy_Info_Source_Var)
190            Subsidy_new;
191          by Nlihc_id poa_start poa_end;
192        
193          where Nlihc_id ~= "";
194        
7 The SAS System                                                                              17:56 Saturday, August 1, 2015

195          ** Subsidy ID number **;
196        
197          if first.Nlihc_id then Subsidy_id = 0;
198        
199          Subsidy_id + 1;
200        
201          POA_start_orig = POA_start;
202        
203          format POA_start_orig POA_end_prev mmddyy10.;
204        
205          ** Set subsidies to not active if project is in Lost Rental list **;
206          ****** NB: NEED TO REVIEW THESE PROJECTS AND FIX SOURCE INFO ******;
207        
208          if Nlihc_id in ( "NL000035", "NL000056", "NL000068", "NL000087", "NL000098",
209                           "NL000105", "NL000132", "NL000134", "NL000137", "NL000196",
210                           "NL000199", "NL000231", "NL000307", "NL000324", "NL000371",
211                           "NL000382", "NL000394", "NL000414", "NL000416" ) then Subsidy_Active = 0;
212        
213          /*
214          Program = left( compbl( Program ) );
215        
216          if Program = '542(b)QPE Risk Sharing-Existing' then Program = '542(b) QPE Risk Sharing-Existing';
217        
218          Program = tranwrd( Program, '/ ', '/' );
219          */
220        
221          length Agency $ 80;
222        
223          if Program = "LIHTC" then Agency = "DC Dept of Housing and Community Development; DC Housing Finance Agency";
224          else if Subsidy_info_Source =: "DCFHA" then Agency = "DC Housing Finance Agency";
225          else if Subsidy_Info_Source =: "DCHA" then Agency = "DC Housing Authority";
226          else if Subsidy_Info_Source in ( "Email from KIM DCHA", "Email from Kim Cole DCHA" ) then Agency = "DC Housing
226      ! Authority";
227          else if Subsidy_Info_Source =: "DHCD" then Agency = "DC Dept of Housing and Community Development";
228          else if Subsidy_Info_Source =: "DC/" then Agency = "DC";
229          else if Subsidy_Info_Source =: "HUD" then Agency = "US Dept of Housing and Urban Development";
230          else Agency = "Other";
231        
232          length Portfolio $ 16;
233        
234          Portfolio = put( Program, $progtoportfolio. );
235        
236          **** CORRECTIONS ****;
237        
238          ** Museum Square One **;
239        
8 The SAS System                                                                              17:56 Saturday, August 1, 2015

240          if nlihc_id = "NL000208" and subsidy_id = 1 then do;
241            poa_end = '31oct2011'd;
242            compl_end = poa_end;
243            Subsidy_Active = 0;
244          end;
245        
246          if nlihc_id = "NL000208" and subsidy_id = 2 then do;
247            poa_end = '01oct2015'd;
248          end;
249        
250          label
251            NLIHC_ID = "Preservation Catalog project ID"
252            Subsidy_ID = "Preservation Catalog subsidy ID"
253            POA_start = "Period of affordability, current start date"
254            POA_start_orig = "Period of affordability, original start date"
255            Compl_end = "Compliance period, end date"
256            POA_end = "Period of affordability, end date"
257            POA_end_prev = "Period of affordability, previous end date"
258            Units_Assist = "Subsidy assisted units"
259            Subsidy_Active = "Subsidy is active"
260            Subsidy_Info_Source = "Source for latest subsidy update"
261            Update_Dtm = "Datetime of last subsidy update"
262            Program = "Subsidy program"
263            Subsidy_Info_Source_ID = "Project ID number for subsidy info source"
264            Subsidy_Info_Source_Date = "Date of last subsidy info source"
265            Agency = "Agency responsible for managing subsidy"
266            Portfolio = "Subsidy portfolio"
267          ;
268        
269          format Program $progfull. Portfolio $portfolio.;
270        
271        run;

NOTE: There were 120 observations read from the data set WORK.SUBSIDY_MFA.
      WHERE Nlihc_id not = ' ';
NOTE: There were 586 observations read from the data set WORK.SUBSIDY_OTHER.
      WHERE Nlihc_id not = ' ';
NOTE: There were 1 observations read from the data set WORK.SUBSIDY_NEW.
      WHERE Nlihc_id not = ' ';
NOTE: The data set PRESCAT.SUBSIDY has 707 observations and 18 variables.
NOTE: Compressing data set PRESCAT.SUBSIDY decreased size by 50.00 percent. 
      Compressed is 8 pages; un-compressed would require 16 pages.
NOTE: DATA statement used (Total process time):
      real time           0.02 seconds
      cpu time            0.03 seconds
      
9 The SAS System                                                                              17:56 Saturday, August 1, 2015


272        
273        /*
274        proc sort data=PresCat.Subsidy;
275          by NLIHC_ID program contract_number;
276        */
277        
278        %File_info( data=PresCat.Subsidy, freqvars=Program Portfolio Subsidy_Info_Source Agency rent_to_FMR_description )
MPRINT(FILE_INFO):   title2 "File = PresCat.Subsidy";
MPRINT(FILE_INFO):   proc contents data=PresCat.Subsidy;
MPRINT(FILE_INFO):   run;

NOTE: PROCEDURE CONTENTS used (Total process time):
      real time           0.03 seconds
      cpu time            0.03 seconds
      
NOTE: The PROCEDURE CONTENTS printed pages 1-2.

MPRINT(FILE_INFO):   proc print data=PresCat.Subsidy (obs=10);
MPRINT(FILE_INFO):   title3 "Printing first 10 obs.";
MPRINT(FILE_INFO):   run;

NOTE: There were 10 observations read from the data set PRESCAT.SUBSIDY.
NOTE: The PROCEDURE PRINT printed pages 3-4.
NOTE: PROCEDURE PRINT used (Total process time):
      real time           0.00 seconds
      cpu time            0.01 seconds
      

MPRINT(FILE_INFO):   title3;
MPRINT(FILE_INFO):   options nolabel;
MPRINT(FILE_INFO):   proc means data=PresCat.Subsidy n sum mean stddev min max;
MPRINT(FILE_INFO):   run;

NOTE: Multiple concurrent threads will be used to summarize data.
NOTE: There were 707 observations read from the data set PRESCAT.SUBSIDY.
NOTE: The PROCEDURE MEANS printed page 5.
NOTE: PROCEDURE MEANS used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
      

MPRINT(FILE_INFO):   options label;
MPRINT(FILE_INFO):   proc freq data=PresCat.Subsidy;
MPRINT(FILE_INFO):   tables Program Portfolio Subsidy_Info_Source Agency rent_to_FMR_description / missing;
MPRINT(FILE_INFO):   run;
10 The SAS System                                                                             17:56 Saturday, August 1, 2015


NOTE: There were 707 observations read from the data set PRESCAT.SUBSIDY.
NOTE: The PROCEDURE FREQ printed pages 6-9.
NOTE: PROCEDURE FREQ used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
      

MPRINT(FILE_INFO):   title2;
279        
280        proc print data=PresCat.Subsidy;
281          where Portfolio = "";
282          id nlihc_id;
283          var Program Portfolio Agency;
284          title2 'Subsidies with missing Portfolio info';
285        run;

NOTE: No observations were selected from data set PRESCAT.SUBSIDY.
NOTE: There were 0 observations read from the data set PRESCAT.SUBSIDY.
      WHERE Portfolio=' ';
NOTE: PROCEDURE PRINT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

286        
287        title2;
288        
289        /******
290        **** Compare with earlier version ****;
291        
292        libname comp 'D:\DCData\Libraries\PresCat\Data\Old';
293        
294        proc sort data=PresCat.Subsidy out=Subsidy_new;
295          by NLIHC_ID program contract_number;
296        
297        proc sort data=Comp.Subsidy out=Subsidy_old;
298          by NLIHC_ID program contract_number;
299        
300        proc compare base=Subsidy_old compare=Subsidy_new listall maxprint=(40,32000);
301          id NLIHC_ID program contract_number;
302        run;
303        ************/

NOTE: SAS Institute Inc., SAS Campus Drive, Cary, NC USA 27513-2414
NOTE: The SAS System used:
11 The SAS System                                                                             17:56 Saturday, August 1, 2015

      real time           0.36 seconds
      cpu time            0.31 seconds
      
